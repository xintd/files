mixed-port: 8689 # HTTP(S) 和 SOCKS 代理混合端口

allow-lan: true # 允许局域网连接
bind-address: "*" # 绑定 IP 地址，仅作用于 allow-lan 为 true，'*'表示所有地址

find-process-mode: strict

#自定义 geodata url
geox-url:
  geoip: "https://xintd.tk/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://xintd.tk/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://xintd.tk/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"

log-level: info # 日志等级 silent/error/warning/info/debug

ipv6: true # 开启 IPv6 总开关，关闭阻断所有 IPv6 链接和屏蔽 DNS 请求 AAAA 记录

external-controller: 0.0.0.0:9090 # RESTful API 监听地址
external-controller-tls: 0.0.0.0:9443 # RESTful API HTTPS 监听地址，需要配置 tls 部分配置文件
# secret: "123456" # `Authorization:Bearer ${secret}`
global-client-fingerprint: chrome

# 类似于 /etc/hosts, 仅支持配置单个 IP
hosts:
# '*.clash.dev': 127.0.0.1

profile:
  # 存储 select 选择记录
  store-selected: false
  # 持久化 fake-ip
  store-fake-ip: true

tun:
  enable: true
  stack: system # gvisor / lwip
  dns-hijack:
    - any:1053 # 需要劫持的 DNS
  auto-route: true

# 嗅探域名
sniffer:
  enable: true
  ## 对 redir-host 类型识别的流量进行强制嗅探
  ## 如：Tun、Redir 和 TProxy 并 DNS 为 redir-host 皆属于
  # force-dns-mapping: false
  ## 对所有未获取到域名的流量进行强制嗅探
  # parse-pure-ip: false
  # 是否使用嗅探结果作为实际访问，默认 true
  # 全局配置，优先级低于 sniffer.sniff 实际配置
  override-destination: false
  sniff:
    # TLS 默认如果不配置 ports 默认嗅探 443
    TLS:
    #  ports: [443, 8443]

    # 默认嗅探 80
    HTTP:
      # 需要嗅探的端口
      ports: [ 80, 8080-8880 ]
      # 可覆盖 sniffer.override-destination
      override-destination: true
  force-domain:
    - +.v2ex.com
  ## 对嗅探结果进行跳过
  # skip-domain:
  #   - Mijia Cloud

dns:
  enable: true # 关闭将使用系统 DNS
  prefer-h3: true # 开启 DoH 支持 HTTP/3，将并发尝试
  listen: :1053 # 开启 DNS 服务器监听
  ipv6: true # false 将返回 AAAA 的空结果

  enhanced-mode: fake-ip # or redir-host
  fake-ip-range: 198.18.0.1/16 # fake-ip 池设置
  fake-ip-filter:
    - '*'
    - '+.lan'
  #use-hosts: true # 查询 hosts

  # 用于解析 nameserver，fallback 以及其他 DNS 服务器配置的，DNS 服务域名
  # 只能使用纯 IP 地址，可使用加密 DNS
  default-nameserver:
    - 223.6.6.6
    - tls://223.6.6.6:853   # DNS over TLS

  # DNS 主要域名配置
  # 支持 UDP，TCP，DoT，DoH，DoQ
  nameserver:
    - https://cloudflare-dns.com/dns-query#replit
    # 强制 HTTP/3，与 perfer-h3 无关，强制开启 DoH 的 HTTP/3 支持，若不支持将无法使用
    - https://mozilla.cloudflare-dns.com/dns-query#replit&h3=true # 指定策略组和使用 HTTP/3
    - dhcp://en0 # dns from dhcp
    - quic://dns.adguard.com:784 # DNS over QUIC
    # - '8.8.8.8#en0' # 兼容指定DNS出口网卡
  # 代理服务器解析DNS:当proxy里的server为域名时，使用该列表里的dns服务器解析
  proxy-server-nameserver :
    - https://dns.alidns.com/dns-query

  # 配置查询域名使用的 DNS 服务器
  # nameserver-policy 可以使用 geosite 分流 DNS 解析。
  # 将国内域名指定为国内 DOH 进行解析，其余 DNS 使用境外 DOH 解析
  nameserver-policy:
    "geosite:cn,private":
      - https://dns.alidns.com/dns-query  # DNS over HTTPS
      - https://doh.pub/dns-query
    #'www.baidu.com': '8.8.8.8'

proxies:
  - {"private-key":"nVomBifkPR1GzzhHS7QWys8zPzA5tjPM/8MjNAC6ih4=","name":"wg","type":"wireguard","server":"162.159.195.3","port":2408,"ip":"172.16.0.2","ipv6":"fd01:5ca1:ab1e:80fa:ab85:6eea:213f:f4a5","public-key":"bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=","udp":true}
  - {"uuid":"bd6383c9-b37d-4e25-85ee-3c98b0eb0dc1","type":"vmess","name":"vs_outlook_vm","ws-opts":{"path":"/vm","headers":{"host":"vs.uoldsix.repl.co"}},"server":"vs.uoldsix.repl.co","port":"443","alterId":"0","cipher":"auto","network":"ws","tls":true,"udp":true,"dialer-proxy":"wg"}
  - {"uuid":"bd6383c9-b37d-4e25-85ee-3c98b0eb0dc1","type":"vless","name":"vs_outlook_vl","server":"vs.uoldsix.repl.co","port":443,"skip-cert-verify":true,"udp":true,"tls":true,"network":"ws","servername":"vs.uoldsix.repl.co","ws-opts":{"path":"/vl","headers":{"host":"vs.uoldsix.repl.co"}},"dialer-proxy":"wg"}
  - {"uuid":"0c7821b4-cf14-478e-96f3-fad1c03be56e","type":"vmess","name":"xs_outlook_vm","ws-opts":{"path":"/vm?ed=2048","headers":{"host":"xs.uoldsix.repl.co"}},"server":"xs.uoldsix.repl.co","port":"443","alterId":"0","cipher":"auto","network":"ws","tls":true,"udp":true,"dialer-proxy":"wg"}
  - {"uuid":"0c7821b4-cf14-478e-96f3-fad1c03be56e","type":"vless","name":"xs_outlook_vl","server":"xs.uoldsix.repl.co","port":443,"skip-cert-verify":true,"udp":true,"tls":true,"network":"ws","servername":"xs.uoldsix.repl.co","ws-opts":{"path":"/vl?ed=2048","headers":{"host":"xs.uoldsix.repl.co"}},"dialer-proxy":"wg"}
  - {"password":"0c7821b4-cf14-478e-96f3-fad1c03be56e","type":"trojan","name":"xs_outlook_tr","server":"xs.uoldsix.repl.co","port":443,"udp":true,"skip-cert-verify":true,"network":"ws","ws-opts":{"path":"/tr","headers":{"host":"xs.uoldsix.repl.co"}},"dialer-proxy":"wg"}

proxy-providers:
  clash:
    type: http
    path: ./proxies/clash.yaml
    url: https://xintd.tk/xintd/Clash.Meta/raw/node/Eternity  #【Meta专属】支持解析V2rayN等工具使用的普通订阅
    interval: 3600
    health-check:
      enable: true
      url: https://g.alicdn.com
      interval: 300
    dialer-proxy: wg

proxy-groups:
  - name: 🚀 PROXY
    type: fallback
    url: https://www.google.com/generate_204
    interval: 300
    proxies:
      - other
      - replit
      - wg

  - name: "replit"
    type: url-test
    interval: 300
    url: https://www.google.com/generate_204
    proxies:
      - vs_outlook_vl
      - vs_outlook_vm
      - xs_outlook_vm
      - xs_outlook_vl
      - xs_outlook_tr

  - name: "other"
    type: url-test
    interval: 300
    url: https://www.google.com/generate_204
    proxies:
      - US
      - Europe
      - CA&AU
      - ZZ
      - JP
      - KR
      - SG
      - HK&MO&TW

  - name: HK&MO&TW
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(🇭🇰|🇲🇴|🇹🇼|HK|台湾)'
    use:
      - clash
  - name: CA&AU
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(加拿大|🇨🇦|🇦🇺|澳大|CA|AU)'
    use:
      - clash
  - name: SG
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(新加坡|🇸🇬|SG)'
    use:
      - clash
  - name: US
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(美|🇺🇸|United States|US)'
    use:
      - clash
  - name: Europe
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(德|🇩🇪|🇫🇷|法|🇳🇱|🇫🇮|DE|FR|NL|FI)'
    use:
      - clash
  - name: JP
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(日|🇯🇵|JP)'
    use:
      - clash
  - name: KR
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(韩|韓|🇰🇷|KR)'
    use:
      - clash
  - name: ZZ
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    exclude-filter: '(?i)(🇭🇰|🇲🇴|🇹🇼|HK|台湾|🇨🇦|🇦🇺|CA|AU|🇸🇬|SG|🇺🇸|US|🇩🇪|🇫🇷|🇳🇱|🇫🇮|DE|FR|NL|FI|🇯🇵|JP|🇰🇷|KR)'
    use:
      - clash

rule-providers:
  cn:
    behavior: domain
    interval: 86400
    path: ./provider/rule-set/cn_domain.yaml
    type: http
    url: "https://xintd.tk/MetaCubeX/meta-rules-dat/releases/download/latest/cn_domain.yaml"
  applications: # 需要直连的常见软件列表
    type: http
    behavior: classical
    url: "https://xintd.tk/Loyalsoldier/clash-rules/raw/release/applications.txt"
    path: ./ruleset/applications.yaml
    interval: 86400

rules:
  - DOMAIN,xintd.tk,DIRECT     #订阅文件直连下载
  - GEOSITE,category-ads-all,REJECT
  - GEOSITE,bing,other
  # 直连
  - GEOSITE,private,DIRECT,no-resolve
  - GEOIP,private,DIRECT,no-resolve
  - RULE-SET,applications,DIRECT
  - RULE-SET,cn,DIRECT
  - GEOSITE,cn,DIRECT
  - GEOIP,CN,DIRECT
  - GEOSITE,onedrive,DIRECT
  - GEOSITE,microsoft@cn,DIRECT
  - GEOSITE,apple-cn,DIRECT
  - GEOSITE,steam@cn,DIRECT
  - GEOSITE,category-games@cn,DIRECT

  - GEOSITE,openai,us
  - GEOSITE,google,🚀 PROXY
  - GEOSITE,youtube,🚀 PROXY
  - GEOSITE,twitter,🚀 PROXY
  - GEOSITE,pixiv,🚀 PROXY
  - GEOSITE,netflix,🚀 PROXY
  - GEOSITE,biliintl,🚀 PROXY

  - MATCH,🚀 PROXY