mixed-port: 8689 # HTTP(S) å’Œ SOCKS ä»£ç†æ··åˆç«¯å£

allow-lan: true # å…è®¸å±€åŸŸç½‘è¿æ¥
bind-address: "*" # ç»‘å®š IP åœ°å€ï¼Œä»…ä½œç”¨äº allow-lan ä¸º trueï¼Œ'*'è¡¨ç¤ºæ‰€æœ‰åœ°å€

#  find-process-mode has 3 values:always, strict, off
#  - always, å¼€å¯ï¼Œå¼ºåˆ¶åŒ¹é…æ‰€æœ‰è¿›ç¨‹
#  - strict, é»˜è®¤ï¼Œç”± clash åˆ¤æ–­æ˜¯å¦å¼€å¯
#  - off, ä¸åŒ¹é…è¿›ç¨‹ï¼Œæ¨èåœ¨è·¯ç”±å™¨ä¸Šä½¿ç”¨æ­¤æ¨¡å¼
find-process-mode: strict

mode: rule

#è‡ªå®šä¹‰ geodata url
geox-url:
  geoip: "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat"
  geosite: "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat"
  mmdb: "https://cdn.jsdelivr.net/gh/Loyalsoldier/geoip@release/Country.mmdb"

log-level: debug # æ—¥å¿—ç­‰çº§ silent/error/warning/info/debug

ipv6: true # å¼€å¯ IPv6 æ€»å¼€å…³ï¼Œå…³é—­é˜»æ–­æ‰€æœ‰ IPv6 é“¾æ¥å’Œå±è”½ DNS è¯·æ±‚ AAAA è®°å½•

tls:
  certificate: string # è¯ä¹¦ PEM æ ¼å¼ï¼Œæˆ–è€… è¯ä¹¦çš„è·¯å¾„
  private-key: string # è¯ä¹¦å¯¹åº”çš„ç§é’¥ PEM æ ¼å¼ï¼Œæˆ–è€…ç§é’¥è·¯å¾„

external-controller: 0.0.0.0:9090 # RESTful API ç›‘å¬åœ°å€
external-controller-tls: 0.0.0.0:9443 # RESTful API HTTPS ç›‘å¬åœ°å€ï¼Œéœ€è¦é…ç½® tls éƒ¨åˆ†é…ç½®æ–‡ä»¶
# secret: "123456" # `Authorization:Bearer ${secret}`

# tcp-concurrent: true # TCP å¹¶å‘è¿æ¥æ‰€æœ‰ IP, å°†ä½¿ç”¨æœ€å¿«æ¡æ‰‹çš„ TCP

# å…¨å±€ TLS æŒ‡çº¹ï¼Œä¼˜å…ˆä½äº proxy å†…çš„ client-fingerprint
# å¯é€‰ï¼š "chrome","firefox","safari","ios","random","none" options.
# Utls is currently support TLS transport in TCP/grpc/WS/HTTP for VLESS/Vmess and trojan.
global-client-fingerprint: chrome

# ç±»ä¼¼äº /etc/hosts, ä»…æ”¯æŒé…ç½®å•ä¸ª IP
hosts:
# '*.clash.dev': 127.0.0.1

profile:
  # å­˜å‚¨ select é€‰æ‹©è®°å½•
  store-selected: false
  # æŒä¹…åŒ– fake-ip
  store-fake-ip: true

tun:
  enable: false
  stack: system # gvisor / lwip
  dns-hijack:
    - 0.0.0.0:5353 # éœ€è¦åŠ«æŒçš„ DNS
  auto-detect-interface: true # è‡ªåŠ¨è¯†åˆ«å‡ºå£ç½‘å¡
  auto-route: true # é…ç½®è·¯ç”±è¡¨

# å—…æ¢åŸŸå
sniffer:
  enable: true
  ## å¯¹ redir-host ç±»å‹è¯†åˆ«çš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  ## å¦‚ï¼šTunã€Redir å’Œ TProxy å¹¶ DNS ä¸º redir-host çš†å±äº
  # force-dns-mapping: false
  ## å¯¹æ‰€æœ‰æœªè·å–åˆ°åŸŸåçš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  # parse-pure-ip: false
  # æ˜¯å¦ä½¿ç”¨å—…æ¢ç»“æœä½œä¸ºå®é™…è®¿é—®ï¼Œé»˜è®¤ true
  # å…¨å±€é…ç½®ï¼Œä¼˜å…ˆçº§ä½äº sniffer.sniff å®é™…é…ç½®
  override-destination: false
  sniff:
    # TLS é»˜è®¤å¦‚æœä¸é…ç½® ports é»˜è®¤å—…æ¢ 443
    TLS:
    #  ports: [443, 8443]

    # é»˜è®¤å—…æ¢ 80
    HTTP:
      # éœ€è¦å—…æ¢çš„ç«¯å£
      ports: [80, 8080-8880]
      # å¯è¦†ç›– sniffer.override-destination
      override-destination: true
  force-domain:
    - +.v2ex.com
  ## å¯¹å—…æ¢ç»“æœè¿›è¡Œè·³è¿‡
  # skip-domain:
  #   - Mijia Cloud

dns:
  enable: true # å…³é—­å°†ä½¿ç”¨ç³»ç»Ÿ DNS
  prefer-h3: true # å¼€å¯ DoH æ”¯æŒ HTTP/3ï¼Œå°†å¹¶å‘å°è¯•
  listen: 0.0.0.0:5353 # å¼€å¯ DNS æœåŠ¡å™¨ç›‘å¬
  # ipv6: false # false å°†è¿”å› AAAA çš„ç©ºç»“æœ

  # ç”¨äºè§£æ nameserverï¼Œfallback ä»¥åŠå…¶ä»– DNS æœåŠ¡å™¨é…ç½®çš„ï¼ŒDNS æœåŠ¡åŸŸå
  # åªèƒ½ä½¿ç”¨çº¯ IP åœ°å€ï¼Œå¯ä½¿ç”¨åŠ å¯† DNS
  default-nameserver:
    - tls://1.12.12.12:853
    - tls://223.6.6.6:853

  enhanced-mode: redir-host # or fake-ip
  fake-ip-range: 198.18.0.1/16 # fake-ip æ± è®¾ç½®

  #use-hosts: true # æŸ¥è¯¢ hosts

  # é…ç½®æŸ¥è¯¢åŸŸåä½¿ç”¨çš„ DNS æœåŠ¡å™¨
  # nameserver-policy å¯ä»¥ä½¿ç”¨ geosite åˆ†æµ DNS è§£æã€‚
  # å°†å›½å†…åŸŸåæŒ‡å®šä¸ºå›½å†… DOH è¿›è¡Œè§£æï¼Œå…¶ä½™ DNS ä½¿ç”¨å¢ƒå¤– DOH è§£æ
  nameserver-policy:
    "geosite:cn":
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query
    #'www.baidu.com': '8.8.8.8'
    #'+.internal.crop.com': '1.0.0.1'

  # DNS ä¸»è¦åŸŸåé…ç½®
  # æ”¯æŒ UDPï¼ŒTCPï¼ŒDoTï¼ŒDoHï¼ŒDoQ
  nameserver:
    - https://dns.cloudflare.com/dns-query
    - https://dns.google/dns-query
    - https://doh.opendns.com/dns-query
    - https://doh.dns.sb/dns-query
    - https://[2001:4860:4860::8888]/dns-query
    - https://[2001:4860:4860::8844]/dns-query
    - https://[2001:4860:4860::6464]/dns-query
    - https://[2001:4860:4860::64]/dns-query

proxies:
  - name: "wg"
    type: wireguard
    server: 162.159.195.3
    port: 2408
    ip: 172.16.0.2
    ipv6: fd01:5ca1:ab1e:80fa:ab85:6eea:213f:f4a5
    private-key: nVomBifkPR1GzzhHS7QWys8zPzA5tjPM/8MjNAC6ih4=
    public-key: bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=
    udp: true

proxy-providers:
  clash:
    type: http
    path: ./proxies/clash.yaml
    url: https://raw.gfile.ga/https://raw.githubusercontent.com/xintd/Clash.Meta/node/Eternity.yaml  #ã€Metaä¸“å±ã€‘æ”¯æŒè§£æV2rayNç­‰å·¥å…·ä½¿ç”¨çš„æ™®é€šè®¢é˜…
    interval: 900
    health-check:
      enable: true
      url: https://www.google.com/generate_204
      interval: 300

proxy-groups:
  - name: ğŸš€ PROXY
    #url-test      é€šè¿‡httping URL è‡ªåŠ¨åˆ‡æ¢å»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹
    #load-balance  strategyç­–ç•¥ï¼šround-robin æ‰€æœ‰è¯·æ±‚ä¸ä½¿ç”¨åŒä¸€ä»£ç†ï¼›consistent-hashingï¼šåŒä¸€æœ‰æ•ˆé¡¶çº§åŸŸå(eTLD)ä½¿ç”¨åŒä¸€ä»£ç†
    #fallback      é€šè¿‡httping URLï¼Œå½“æ²¡æœ‰pingå€¼æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    type: fallback
    interval: 300
    url: https://www.google.com/generate_204
    #strategy: round-robin
    lazy: true           #ä¸ºtrueæ—¶ï¼Œæœªè¢«ä½¿ç”¨æ—¶ä¸è¿›è¡Œæµ‹ping
    proxies:
      - wg
      - HK&MO
      - CA&AU
      - SG
      - US
      - Europe
      - JP
      - KR
      - ZZ

  - name: HK&MO
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(æ¸¯|HK|Hong|MO|æ¾³é—¨)'
    use:
      - clash
  - name: CA&AU
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(åŠ æ‹¿å¤§|CA|AU|æ¾³å¤§)'
    use:
      - clash
  - name: SG
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(æ–°åŠ å¡|SG)'
    use:
      - clash
  - name: US
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(ç¾|US|United States)'
    use:
      - clash
  - name: Europe
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(å¾·|DE|FR|æ³•|NL|FI)'
    use:
      - clash
  - name: JP
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(æ—¥|JP)'
    use:
      - clash
  - name: KR
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(éŸ©|éŸ“|KR)'
    use:
      - clash
  - name: ZZ
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    exclude-filter: '(?i)(æ¸¯|HK|Hong|MO|æ¾³é—¨|åŠ æ‹¿å¤§|CA|AU|æ¾³å¤§|æ–°åŠ å¡|SG|ç¾|US|United States|å¾·|DE|FR|æ³•|NL|FI|æ—¥|JP|éŸ©|éŸ“|KR)'
    use:
      - clash
  - name: ğŸ¤˜ æ‰‹åŠ¨é€‰æ‹©
    type: select
    use:
      - clash

rule-providers:
  reject: # å¹¿å‘ŠåŸŸååˆ—è¡¨
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt"
    path: ./ruleset/reject.yaml
    interval: 86400

  icloud: # iCloud åŸŸååˆ—è¡¨
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt"
    path: ./ruleset/icloud.yaml
    interval: 86400

  apple: # Apple åœ¨ä¸­å›½å¤§é™†å¯ç›´è¿çš„åŸŸååˆ—è¡¨
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt"
    path: ./ruleset/apple.yaml
    interval: 86400

  google: # Google åœ¨ä¸­å›½å¤§é™†å¯ç›´è¿çš„åŸŸååˆ—è¡¨
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt"
    path: ./ruleset/google.yaml
    interval: 86400

  proxy: # ä»£ç†åŸŸååˆ—è¡¨
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
    path: ./ruleset/proxy.yaml
    interval: 86400

  direct: # ç›´è¿åŸŸååˆ—è¡¨
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./ruleset/direct.yaml
    interval: 86400

  private: # ç§æœ‰ç½‘ç»œä¸“ç”¨åŸŸååˆ—è¡¨
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
    path: ./ruleset/private.yaml
    interval: 86400

  gfw: # GFWList åŸŸååˆ—è¡¨
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt"
    path: ./ruleset/gfw.yaml
    interval: 86400

  greatfire: # GreatFire åŸŸååˆ—è¡¨
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/greatfire.txt"
    path: ./ruleset/greatfire.yaml
    interval: 86400

  tld-not-cn: # éä¸­å›½å¤§é™†ä½¿ç”¨çš„é¡¶çº§åŸŸååˆ—è¡¨
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt"
    path: ./ruleset/tld-not-cn.yaml
    interval: 86400

  telegramcidr: # Telegram ä½¿ç”¨çš„ IP åœ°å€åˆ—è¡¨
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt"
    path: ./ruleset/telegramcidr.yaml
    interval: 86400

  cncidr: # ä¸­å›½å¤§é™† IP åœ°å€åˆ—è¡¨
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./ruleset/cncidr.yaml
    interval: 86400

  lancidr: # å±€åŸŸç½‘ IP åŠä¿ç•™ IP åœ°å€åˆ—è¡¨
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
    path: ./ruleset/lancidr.yaml
    interval: 86400

  applications: # éœ€è¦ç›´è¿çš„å¸¸è§è½¯ä»¶åˆ—è¡¨
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
    path: ./ruleset/applications.yaml
    interval: 86400

rules:
  - DOMAIN,raw.gfile.ga,DIRECT     #è®¢é˜…æ–‡ä»¶ç›´è¿ä¸‹è½½
  - DOMAIN,cdn.jsdelivr.net,DIRECT     #è§„åˆ™æ–‡ä»¶ç›´è¿ä¸‹è½½
  - PROCESS-NAME,v2ray,DIRECT
  - PROCESS-NAME,xray,DIRECT
  - PROCESS-NAME,naive,DIRECT
  - PROCESS-NAME,trojan,DIRECT
  - PROCESS-NAME,trojan-go,DIRECT
  - PROCESS-NAME,ss-local,DIRECT
  - PROCESS-NAME,privoxy,DIRECT
  - PROCESS-NAME,leaf,DIRECT
  - PROCESS-NAME,v2ray.exe,DIRECT
  - PROCESS-NAME,xray.exe,DIRECT
  - PROCESS-NAME,naive.exe,DIRECT
  - PROCESS-NAME,trojan.exe,DIRECT
  - PROCESS-NAME,trojan-go.exe,DIRECT
  - PROCESS-NAME,ss-local.exe,DIRECT
  - PROCESS-NAME,privoxy.exe,DIRECT
  - PROCESS-NAME,leaf.exe,DIRECT
  - PROCESS-NAME,Surge,DIRECT
  - PROCESS-NAME,Surge 2,DIRECT
  - PROCESS-NAME,Surge 3,DIRECT
  - PROCESS-NAME,Surge 4,DIRECT
  - PROCESS-NAME,Surge%202,DIRECT
  - PROCESS-NAME,Surge%203,DIRECT
  - PROCESS-NAME,Surge%204,DIRECT
  - PROCESS-NAME,Thunder,DIRECT
  - PROCESS-NAME,DownloadService,DIRECT
  - PROCESS-NAME,qBittorrent,DIRECT
  - PROCESS-NAME,Transmission,DIRECT
  - PROCESS-NAME,fdm,DIRECT
  - PROCESS-NAME,aria2c,DIRECT
  - PROCESS-NAME,Folx,DIRECT
  - PROCESS-NAME,NetTransport,DIRECT
  - PROCESS-NAME,uTorrent,DIRECT
  - PROCESS-NAME,WebTorrent,DIRECT
  - PROCESS-NAME,aria2c.exe,DIRECT
  - PROCESS-NAME,BitComet.exe,DIRECT
  - PROCESS-NAME,fdm.exe,DIRECT
  - PROCESS-NAME,NetTransport.exe,DIRECT
  - PROCESS-NAME,qbittorrent.exe,DIRECT
  - PROCESS-NAME,Thunder.exe,DIRECT
  - PROCESS-NAME,ThunderVIP.exe,DIRECT
  - PROCESS-NAME,transmission-daemon.exe,DIRECT
  - PROCESS-NAME,transmission-qt.exe,DIRECT
  - PROCESS-NAME,uTorrent.exe,DIRECT
  - PROCESS-NAME,WebTorrent.exe,DIRECT
  - DOMAIN,clash.razord.top,DIRECT
  - DOMAIN,yacd.haishan.me,DIRECT
  - RULE-SET,applications,DIRECT
  - RULE-SET,private,DIRECT
  - RULE-SET,reject,REJECT
  - RULE-SET,icloud,DIRECT #
  - RULE-SET,apple,DIRECT # è¿™ä¸‰ä¸ªä¸ºå›½å†…å¯ç›´è¿åœ°å€ï¼Œå¦‚æœå¸Œæœ›èµ°ä»£ç†æ”¹ä¸ºğŸš€ PROXY
  - RULE-SET,google,DIRECT #
  - RULE-SET,proxy,ğŸš€ PROXY
  - RULE-SET,direct,DIRECT
  - RULE-SET,telegramcidr,ğŸš€ PROXY
  - GEOIP,LAN,DIRECT,no-resolve
  - GEOIP,CN,DIRECT,no-resolve
  - RULE-SET,lancidr,DIRECT
  - RULE-SET,cncidr,DIRECT
  - DOMAIN-SUFFIX,bilibili.com,DIRECT,tcp   #ã€Metaä¸“å±ã€‘å¯æŒ‡å®šåè®®ç±»å‹(tcp/udp)
#ã€Metaä¸“å±ã€‘é€»è¾‘åˆ¤æ–­è§„åˆ™
# - AND,((DOMAIN,baidu.com),(NETWORK,UDP)),DIRECT #AND(å’Œ):åŸŸåä¸ºbaidu.comçš„UDPåè®®
# - OR,((NETWORK,UDP),(DOMAIN,baidu.com)),REJECT  #OR(æˆ–):UDPçš„åè®®ï¼Œæˆ–è€…åŸŸåä¸ºbaidu.com
# - NOT,((DOMAIN,baidu.com)),PROXY                #NOT(å¦)ï¼šåŸŸåä¸ä¸ºbaidu.comè®¿é—®
  - OR,((DOMAIN,live.yj1211.work),(DOMAIN-KEYWORD,555dy)),DIRECT
#åŸŸåå…³é”®è¯ä¸ºbilibiliæˆ–è€…douyuçš„UDPåè®®
  - AND,((OR,((DOMAIN-KEYWORD,bilibili),(DOMAIN-KEYWORD,douyu))),(NETWORK,UDP)),REJECT
  - MATCH,ğŸš€ PROXY