mixed-port: 8689 # HTTP(S) å’Œ SOCKS ä»£ç†æ··åˆç«¯å£

allow-lan: true # å…è®¸å±€åŸŸç½‘è¿æ¥
bind-address: "*" # ç»‘å®š IP åœ°å€ï¼Œä»…ä½œç”¨äº allow-lan ä¸º trueï¼Œ'*'è¡¨ç¤ºæ‰€æœ‰åœ°å€

find-process-mode: strict

#è‡ªå®šä¹‰ geodata url
geox-url:
  geoip: "https://xintd.tk/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://xintd.tk/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://xintd.tk/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"

log-level: info # æ—¥å¿—ç­‰çº§ silent/error/warning/info/debug

ipv6: true # å¼€å¯ IPv6 æ€»å¼€å…³ï¼Œå…³é—­é˜»æ–­æ‰€æœ‰ IPv6 é“¾æ¥å’Œå±è”½ DNS è¯·æ±‚ AAAA è®°å½•

external-controller: 0.0.0.0:9090 # RESTful API ç›‘å¬åœ°å€
external-controller-tls: 0.0.0.0:9443 # RESTful API HTTPS ç›‘å¬åœ°å€ï¼Œéœ€è¦é…ç½® tls éƒ¨åˆ†é…ç½®æ–‡ä»¶
# secret: "123456" # `Authorization:Bearer ${secret}`
global-client-fingerprint: chrome

# ç±»ä¼¼äº /etc/hosts, ä»…æ”¯æŒé…ç½®å•ä¸ª IP
hosts:
# '*.clash.dev': 127.0.0.1

profile:
  # å­˜å‚¨ select é€‰æ‹©è®°å½•
  store-selected: false
  # æŒä¹…åŒ– fake-ip
  store-fake-ip: true

tun:
  enable: true
  stack: system # gvisor / lwip
  dns-hijack:
    - any:1053 # éœ€è¦åŠ«æŒçš„ DNS
  auto-route: true

# å—…æ¢åŸŸå
sniffer:
  enable: true
  ## å¯¹ redir-host ç±»å‹è¯†åˆ«çš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  ## å¦‚ï¼šTunã€Redir å’Œ TProxy å¹¶ DNS ä¸º redir-host çš†å±äº
  # force-dns-mapping: false
  ## å¯¹æ‰€æœ‰æœªè·å–åˆ°åŸŸåçš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  # parse-pure-ip: false
  # æ˜¯å¦ä½¿ç”¨å—…æ¢ç»“æœä½œä¸ºå®é™…è®¿é—®ï¼Œé»˜è®¤ true
  # å…¨å±€é…ç½®ï¼Œä¼˜å…ˆçº§ä½äº sniffer.sniff å®é™…é…ç½®
  override-destination: false
  sniff:
    # TLS é»˜è®¤å¦‚æœä¸é…ç½® ports é»˜è®¤å—…æ¢ 443
    TLS:
    #  ports: [443, 8443]

    # é»˜è®¤å—…æ¢ 80
    HTTP:
      # éœ€è¦å—…æ¢çš„ç«¯å£
      ports: [ 80, 8080-8880 ]
      # å¯è¦†ç›– sniffer.override-destination
      override-destination: true
  force-domain:
    - +.v2ex.com
  ## å¯¹å—…æ¢ç»“æœè¿›è¡Œè·³è¿‡
  # skip-domain:
  #   - Mijia Cloud

dns:
  enable: true # å…³é—­å°†ä½¿ç”¨ç³»ç»Ÿ DNS
  prefer-h3: true # å¼€å¯ DoH æ”¯æŒ HTTP/3ï¼Œå°†å¹¶å‘å°è¯•
  listen: :1053 # å¼€å¯ DNS æœåŠ¡å™¨ç›‘å¬
  ipv6: true # false å°†è¿”å› AAAA çš„ç©ºç»“æœ

  enhanced-mode: fake-ip # or redir-host
  fake-ip-range: 198.18.0.1/16 # fake-ip æ± è®¾ç½®
  fake-ip-filter:
    - '*'
    - '+.lan'
  #use-hosts: true # æŸ¥è¯¢ hosts

  # ç”¨äºè§£æ nameserverï¼Œfallback ä»¥åŠå…¶ä»– DNS æœåŠ¡å™¨é…ç½®çš„ï¼ŒDNS æœåŠ¡åŸŸå
  # åªèƒ½ä½¿ç”¨çº¯ IP åœ°å€ï¼Œå¯ä½¿ç”¨åŠ å¯† DNS
  default-nameserver:
    - 223.6.6.6
    - tls://223.6.6.6:853   # DNS over TLS

  # DNS ä¸»è¦åŸŸåé…ç½®
  # æ”¯æŒ UDPï¼ŒTCPï¼ŒDoTï¼ŒDoHï¼ŒDoQ
  nameserver:
    - https://cloudflare-dns.com/dns-query#replit
    # å¼ºåˆ¶ HTTP/3ï¼Œä¸ perfer-h3 æ— å…³ï¼Œå¼ºåˆ¶å¼€å¯ DoH çš„ HTTP/3 æ”¯æŒï¼Œè‹¥ä¸æ”¯æŒå°†æ— æ³•ä½¿ç”¨
    - https://mozilla.cloudflare-dns.com/dns-query#replit&h3=true # æŒ‡å®šç­–ç•¥ç»„å’Œä½¿ç”¨ HTTP/3
    - dhcp://en0 # dns from dhcp
    - quic://dns.adguard.com:784 # DNS over QUIC
    # - '8.8.8.8#en0' # å…¼å®¹æŒ‡å®šDNSå‡ºå£ç½‘å¡
  # ä»£ç†æœåŠ¡å™¨è§£æDNS:å½“proxyé‡Œçš„serverä¸ºåŸŸåæ—¶ï¼Œä½¿ç”¨è¯¥åˆ—è¡¨é‡Œçš„dnsæœåŠ¡å™¨è§£æ
  proxy-server-nameserver :
    - https://dns.alidns.com/dns-query

  # é…ç½®æŸ¥è¯¢åŸŸåä½¿ç”¨çš„ DNS æœåŠ¡å™¨
  # nameserver-policy å¯ä»¥ä½¿ç”¨ geosite åˆ†æµ DNS è§£æã€‚
  # å°†å›½å†…åŸŸåæŒ‡å®šä¸ºå›½å†… DOH è¿›è¡Œè§£æï¼Œå…¶ä½™ DNS ä½¿ç”¨å¢ƒå¤– DOH è§£æ
  nameserver-policy:
    "geosite:cn,private":
      - https://dns.alidns.com/dns-query  # DNS over HTTPS
      - https://doh.pub/dns-query
    #'www.baidu.com': '8.8.8.8'

proxies:
  - {"private-key":"nVomBifkPR1GzzhHS7QWys8zPzA5tjPM/8MjNAC6ih4=","name":"wg","type":"wireguard","server":"162.159.195.3","port":2408,"ip":"172.16.0.2","ipv6":"fd01:5ca1:ab1e:80fa:ab85:6eea:213f:f4a5","public-key":"bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=","udp":true}
  - {"uuid":"bd6383c9-b37d-4e25-85ee-3c98b0eb0dc1","type":"vmess","name":"vs_outlook_vm","ws-opts":{"path":"/vm","headers":{"host":"vs.uoldsix.repl.co"}},"server":"vs.uoldsix.repl.co","port":"443","alterId":"0","cipher":"auto","network":"ws","tls":true,"udp":true,"dialer-proxy":"wg"}
  - {"uuid":"bd6383c9-b37d-4e25-85ee-3c98b0eb0dc1","type":"vless","name":"vs_outlook_vl","server":"vs.uoldsix.repl.co","port":443,"skip-cert-verify":true,"udp":true,"tls":true,"network":"ws","servername":"vs.uoldsix.repl.co","ws-opts":{"path":"/vl","headers":{"host":"vs.uoldsix.repl.co"}},"dialer-proxy":"wg"}
  - {"uuid":"0c7821b4-cf14-478e-96f3-fad1c03be56e","type":"vmess","name":"xs_outlook_vm","ws-opts":{"path":"/vm?ed=2048","headers":{"host":"xs.uoldsix.repl.co"}},"server":"xs.uoldsix.repl.co","port":"443","alterId":"0","cipher":"auto","network":"ws","tls":true,"udp":true,"dialer-proxy":"wg"}
  - {"uuid":"0c7821b4-cf14-478e-96f3-fad1c03be56e","type":"vless","name":"xs_outlook_vl","server":"xs.uoldsix.repl.co","port":443,"skip-cert-verify":true,"udp":true,"tls":true,"network":"ws","servername":"xs.uoldsix.repl.co","ws-opts":{"path":"/vl?ed=2048","headers":{"host":"xs.uoldsix.repl.co"}},"dialer-proxy":"wg"}
  - {"password":"0c7821b4-cf14-478e-96f3-fad1c03be56e","type":"trojan","name":"xs_outlook_tr","server":"xs.uoldsix.repl.co","port":443,"udp":true,"skip-cert-verify":true,"network":"ws","ws-opts":{"path":"/tr","headers":{"host":"xs.uoldsix.repl.co"}},"dialer-proxy":"wg"}

proxy-providers:
  clash:
    type: http
    path: ./proxies/clash.yaml
    url: https://xintd.tk/xintd/Clash.Meta/raw/node/Eternity  #ã€Metaä¸“å±ã€‘æ”¯æŒè§£æV2rayNç­‰å·¥å…·ä½¿ç”¨çš„æ™®é€šè®¢é˜…
    interval: 3600
    health-check:
      enable: true
      url: https://g.alicdn.com
      interval: 300
    dialer-proxy: wg

proxy-groups:
  - name: ğŸš€ PROXY
    type: fallback
    url: https://www.google.com/generate_204
    interval: 300
    proxies:
      - other
      - replit
      - wg

  - name: "replit"
    type: url-test
    interval: 300
    url: https://www.google.com/generate_204
    proxies:
      - vs_outlook_vl
      - vs_outlook_vm
      - xs_outlook_vm
      - xs_outlook_vl
      - xs_outlook_tr

  - name: "other"
    type: url-test
    interval: 300
    url: https://www.google.com/generate_204
    proxies:
      - US
      - Europe
      - CA&AU
      - ZZ
      - JP
      - KR
      - SG
      - HK&MO&TW

  - name: HK&MO&TW
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(ğŸ‡­ğŸ‡°|ğŸ‡²ğŸ‡´|ğŸ‡¹ğŸ‡¼|HK|å°æ¹¾)'
    use:
      - clash
  - name: CA&AU
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(åŠ æ‹¿å¤§|ğŸ‡¨ğŸ‡¦|ğŸ‡¦ğŸ‡º|æ¾³å¤§|CA|AU)'
    use:
      - clash
  - name: SG
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(æ–°åŠ å¡|ğŸ‡¸ğŸ‡¬|SG)'
    use:
      - clash
  - name: US
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(ç¾|ğŸ‡ºğŸ‡¸|United States|US)'
    use:
      - clash
  - name: Europe
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(å¾·|ğŸ‡©ğŸ‡ª|ğŸ‡«ğŸ‡·|æ³•|ğŸ‡³ğŸ‡±|ğŸ‡«ğŸ‡®|DE|FR|NL|FI)'
    use:
      - clash
  - name: JP
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(æ—¥|ğŸ‡¯ğŸ‡µ|JP)'
    use:
      - clash
  - name: KR
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    filter: '(?i)(éŸ©|éŸ“|ğŸ‡°ğŸ‡·|KR)'
    use:
      - clash
  - name: ZZ
    type: url-test
    interval: 300
    tolerance: 100
    url: https://www.google.com/generate_204
    exclude-filter: '(?i)(ğŸ‡­ğŸ‡°|ğŸ‡²ğŸ‡´|ğŸ‡¹ğŸ‡¼|HK|å°æ¹¾|ğŸ‡¨ğŸ‡¦|ğŸ‡¦ğŸ‡º|CA|AU|ğŸ‡¸ğŸ‡¬|SG|ğŸ‡ºğŸ‡¸|US|ğŸ‡©ğŸ‡ª|ğŸ‡«ğŸ‡·|ğŸ‡³ğŸ‡±|ğŸ‡«ğŸ‡®|DE|FR|NL|FI|ğŸ‡¯ğŸ‡µ|JP|ğŸ‡°ğŸ‡·|KR)'
    use:
      - clash

rule-providers:
  cn:
    behavior: domain
    interval: 86400
    path: ./provider/rule-set/cn_domain.yaml
    type: http
    url: "https://xintd.tk/MetaCubeX/meta-rules-dat/releases/download/latest/cn_domain.yaml"
  applications: # éœ€è¦ç›´è¿çš„å¸¸è§è½¯ä»¶åˆ—è¡¨
    type: http
    behavior: classical
    url: "https://xintd.tk/Loyalsoldier/clash-rules/raw/release/applications.txt"
    path: ./ruleset/applications.yaml
    interval: 86400

rules:
  - DOMAIN,xintd.tk,DIRECT     #è®¢é˜…æ–‡ä»¶ç›´è¿ä¸‹è½½
  - GEOSITE,category-ads-all,REJECT
  - GEOSITE,bing,other
  # ç›´è¿
  - GEOSITE,private,DIRECT,no-resolve
  - GEOIP,private,DIRECT,no-resolve
  - RULE-SET,applications,DIRECT
  - RULE-SET,cn,DIRECT
  - GEOSITE,cn,DIRECT
  - GEOIP,CN,DIRECT
  - GEOSITE,onedrive,DIRECT
  - GEOSITE,microsoft@cn,DIRECT
  - GEOSITE,apple-cn,DIRECT
  - GEOSITE,steam@cn,DIRECT
  - GEOSITE,category-games@cn,DIRECT

  - GEOSITE,openai,us
  - GEOSITE,google,ğŸš€ PROXY
  - GEOSITE,youtube,ğŸš€ PROXY
  - GEOSITE,twitter,ğŸš€ PROXY
  - GEOSITE,pixiv,ğŸš€ PROXY
  - GEOSITE,netflix,ğŸš€ PROXY
  - GEOSITE,biliintl,ğŸš€ PROXY

  - MATCH,ğŸš€ PROXY